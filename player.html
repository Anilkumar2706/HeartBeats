<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HeartBeats - Player</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Make song-list a grid with 6 items per row */
    #songList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="user-info">
    <span id="usernameDisplay"></span>
    <button id="logoutBtn">Log Out</button>
  </div>

  <!-- Removed Sidebar entirely -->
  <div class="content" id="mainContent">
    <h1 id="pageTitle">Discover</h1>
    <div class="search-box" id="searchBox">
      <input type="text" id="search" placeholder="Search songs...">
    </div>
    <div class="song-list" id="songList"></div>
    <div class="library" id="libraryView" style="display:none;"></div>
    <div class="album-view" id="albumView" style="display:none;"></div>
  </div>

  <!-- Bottom Player -->
  <div class="player-bar">
    <div class="player-left">
      <img id="albumArt" src="player image.JPEG" alt="Album Art">
      <div class="info">
        <span id="currentTitle">Select a song</span>
        <span class="artist" id="currentArtist">Artist</span>
      </div>
    </div>
    <div class="controls">
      <div class="controls-buttons">
        <i id="shuffle" class="fas fa-random"></i>
        <i id="prev" class="fas fa-backward"></i>
        <i id="play" class="fas fa-play"></i>
        <i id="next" class="fas fa-forward"></i>
        <i id="repeat" class="fas fa-redo"></i>
        <i id="createAlbumBtn" class="fas fa-plus" title="Create Album" style="cursor:pointer; color:#bbb;"></i>
        <i id="likeBtn" class="fas fa-heart" title="Like Song" style="cursor:pointer; color:#bbb;"></i>
      </div>
    </div>
    <div class="player-right">
      <i class="fas fa-volume-up"></i>
      <input type="range" min="0" max="1" step="0.01" value="1" class="volume" id="volume">
    </div>
    <div class="progress-container" id="progress-container">
      <div class="progress" id="progress"></div>
    </div>
  </div>

  <audio id="disc"></audio>

  <script>
    const user = JSON.parse(localStorage.getItem('heartbeatUser'));
    if (!user) window.location.href = "home.html";
    document.getElementById('usernameDisplay').textContent = "Hi, " + user.username;
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('heartbeatUser');
      localStorage.removeItem('heartbeatState');
      window.location.href = "home.html";
    });

    const disc = document.getElementById('disc');
    const albumArt = document.getElementById('albumArt');
    const currentTitle = document.getElementById('currentTitle');
    const currentArtist = document.getElementById('currentArtist');
    const playBtn = document.getElementById('play');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const progress = document.getElementById('progress');
    const progressContainer = document.getElementById('progress-container');
    const volumeControl = document.getElementById('volume');
    const shuffleBtn = document.getElementById('shuffle');
    const repeatBtn = document.getElementById('repeat');
    const searchInput = document.getElementById('search');
    const songListEl = document.getElementById('songList');
    const libraryView = document.getElementById('libraryView');
    const albumView = document.getElementById('albumView');
    const likeBtn = document.getElementById('likeBtn');
    const createAlbumBtn = document.getElementById('createAlbumBtn');

    let isShuffle = false, isRepeat = false, songIndex = 0;
    const defaultArt = "player image.JPEG";

    const songs = [
      { title: "Ayudha Pooja", artist: "Anirudh", coverPath: defaultArt, discPath: "songs/Ayudha Pooja.mp3" },
      { title: "Chuttamalle", artist: "Sid Sriram", coverPath: defaultArt, discPath: "songs/Chuttamalle.mp3" },
      { title: "Daavudi", artist: "Anurag Kulkarni", coverPath: defaultArt, discPath: "songs/Daavudi.mp3" },
      { title: "Devara Thandavam", artist: "DSP", coverPath: defaultArt, discPath: "songs/Devara Thandavam.mp3" },
      { title: "Fear", artist: "Anirudh", coverPath: defaultArt, discPath: "songs/fear.mp3" },
      { title: "Hridiyam Lopala", artist: "Sid Sriram", coverPath: defaultArt, discPath: "songs/Hridiyam Lopala.mp3" },
      { title: "Monica", artist: "DSP", coverPath: defaultArt, discPath: "songs/Monica.mp3" },
      { title: "Poyiraa Mama", artist: "Anirudh", coverPath: defaultArt, discPath: "songs/Poyiraa Mama.mp3" },
      { title: "Red Sea", artist: "DSP", coverPath: defaultArt, discPath: "songs/Red Sea.mp3" },
      { title: "Tiger", artist: "Anirudh", coverPath: defaultArt, discPath: "songs/tiger.mp3" }
    ];

    let likedSongs = JSON.parse(localStorage.getItem('likedSongs')) || [];
    let albums = JSON.parse(localStorage.getItem('albums')) || [];

    function loadSong(song) {
      disc.src = song.discPath;
      albumArt.src = song.coverPath;
      currentTitle.textContent = song.title;
      currentArtist.textContent = song.artist;
      updateLikeButton();
      saveState();
    }

    function playPauseMedia() { disc.paused ? disc.play() : disc.pause(); }
    function gotoNextSong(play = false) {
      songIndex = isShuffle ? Math.floor(Math.random() * songs.length) : (songIndex + 1) % songs.length;
      loadSong(songs[songIndex]); if (play) disc.play();
    }
    function gotoPreviousSong() {
      songIndex = songIndex === 0 ? songs.length - 1 : songIndex - 1;
      loadSong(songs[songIndex]); disc.play();
    }

    function saveState() {
      localStorage.setItem('heartbeatState', JSON.stringify({ index: songIndex, time: disc.currentTime }));
      localStorage.setItem('likedSongs', JSON.stringify(likedSongs));
      localStorage.setItem('albums', JSON.stringify(albums));
    }
    function updateLikeButton() {
      const currentSong = songs[songIndex];
      likeBtn.style.color = likedSongs.some(s => s.title === currentSong.title) ? "#1db954" : "#bbb";
    }

    likeBtn.addEventListener('click', () => {
      const currentSong = songs[songIndex];
      likedSongs = likedSongs.some(s => s.title === currentSong.title) ?
        likedSongs.filter(s => s.title !== currentSong.title) :
        [...likedSongs, currentSong];
      updateLikeButton(); saveState(); renderLibrary();
    });

    createAlbumBtn.addEventListener('click', () => {
      const name = prompt("Enter album name:");
      if (name) { albums.push({ id: Date.now(), name, createdAt: new Date().toLocaleDateString(), cover: defaultArt, songs: [] }); saveState(); renderLibrary(); }
    });

    function renderLibrary() {
      libraryView.style.display = "block"; albumView.style.display = "none";
      libraryView.innerHTML = `
        <h2>Your Albums</h2>
        <div class="song-list">${albums.length ? albums.map(a => `
          <div class="song-card album-card" data-id="${a.id}">
            <img src="${a.cover}" alt=""><h4>${a.name}</h4><small>${a.createdAt}</small>
          </div>`).join('') : "<p>No albums yet.</p>"}
        </div>
        <h2>Liked Songs</h2>
        <div class="song-list">${likedSongs.length ? likedSongs.map((s,i) => `
          <div class="song-card liked-song" data-index="${i}">
            <img src="${s.coverPath}" alt=""><h4>${s.title}</h4><small>${s.artist}</small>
            <i class="fas fa-trash remove-btn" data-index="${i}" title="Unlike"></i>
          </div>`).join('') : "<p>No liked songs yet.</p>"}
        </div>`;
      libraryView.querySelectorAll('.liked-song').forEach((c, idx) => {
        c.addEventListener('click', () => { const song = likedSongs[idx]; if (song) { songIndex = songs.indexOf(song)>=0?songs.indexOf(song):0; loadSong(song); disc.play(); } });
        c.querySelector('.remove-btn').addEventListener('click', e => { e.stopPropagation(); likedSongs.splice(idx,1); saveState(); renderLibrary(); });
      });
    }

    playBtn.addEventListener('click', playPauseMedia);
    nextBtn.addEventListener('click', () => gotoNextSong(true));
    prevBtn.addEventListener('click', gotoPreviousSong);
    shuffleBtn.addEventListener('click', () => { isShuffle = !isShuffle; shuffleBtn.style.color = isShuffle ? "#1db954" : "#bbb"; });
    repeatBtn.addEventListener('click', () => { isRepeat = !isRepeat; repeatBtn.style.color = isRepeat ? "#1db954" : "#bbb"; });
    volumeControl.addEventListener('input', () => disc.volume = volumeControl.value);

    // Smooth progress update
    setInterval(() => {
      if (!isNaN(disc.duration)) progress.style.width = (disc.currentTime / disc.duration) * 100 + "%";
    }, 100);

    disc.addEventListener('ended', () => isRepeat ? disc.play() : gotoNextSong(true));
    progressContainer.addEventListener('click', e => disc.currentTime = (e.offsetX / progressContainer.clientWidth) * disc.duration);
    disc.addEventListener('play', () => playBtn.classList.replace('fa-play','fa-pause'));
    disc.addEventListener('pause', () => playBtn.classList.replace('fa-pause','fa-play'));

    searchInput.addEventListener('input', () => {
      const q = searchInput.value.toLowerCase();
      document.querySelectorAll('.song-card').forEach(c => c.style.display = c.innerText.toLowerCase().includes(q) ? '' : 'none');
    });

    // Render songs grid
    songs.forEach((song, i) => {
      const div = document.createElement('div');
      div.className = "song-card";
      div.innerHTML = `<img src="${song.coverPath}" alt=""><h4>${song.title}</h4><small>${song.artist}</small>`;
      div.addEventListener('click', () => { songIndex = i; loadSong(song); disc.play(); });
      songListEl.appendChild(div);
    });

    const saved = JSON.parse(localStorage.getItem('heartbeatState'));
    if (saved) { songIndex = saved.index; loadSong(songs[songIndex]); disc.currentTime = saved.time || 0; } else { loadSong(songs[songIndex]); }
  </script>
</body>
</html>
